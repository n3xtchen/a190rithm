# CLAUDE.md 渐进式迭代指南

## 核心原则

```
每个迭代周期 = 添加规范 → 测试任务 → 验证输出 → 调整规范
```

---

## 迭代路线图

| 阶段 | 聚焦点 | 验证重点 |
|------|--------|----------|
| V0.1 | 核心理念 | 探索循环思维是否体现 |
| V0.2 | 工程规范 | 开发流程和目录结构是否遵循 |
| V0.3 | Notebook 结构 | 叙述者角色和标题层级 |
| V0.4 | 单元格规范 | Markdown/代码单元格规范 |
| V1.0 | 整合验证 | 完整流程端到端验证 |

---

## 阶段 V0.1：核心理念

**目标**：验证"内省式探索循环"思维是否贯穿分析过程

**CLAUDE.md 内容**：

```markdown
## 核心理念：内省式探索循环

首要目标是**探索、发现和理解**，而非急于得出结论。

### 探索循环

观察 → 提问 → 假设 → 验证 → 反思 → 新问题

### 实践原则

- 先理解，后行动
- 保持好奇心
- 质疑假设
- 记录思考过程
- 拥抱意外
```

**验证任务**：

```
请探索 iris 数据集，我想了解这个数据集的特点
```

**验证清单**：

- [ ] 是否先观察数据再动手分析？
- [ ] 是否提出了探索性问题？
- [ ] 是否记录了"发现了什么"？
- [ ] 遇到意外时是否深入探究？

---

## 阶段 V0.2：工程规范

**目标**：验证开发流程意识和目录结构理解

**新增规范**：

```markdown
## 工程规范

### 开发流程

Notebook 原型开发 → 逻辑验证 → 重构至 src/ 模块化

- Notebook：用于探索、实验和原型验证
- src/ 模块：验证成功的逻辑重构为可复用模块

### 语言约定

- 文档和 Notebook 使用中文
- Python 代码遵循 PEP 8
```

**验证任务**：

```
请帮我实现一个数据加载工具，支持从 data/raw/ 读取 CSV 文件
```

**验证清单**：

- [ ] 是否先在 Notebook 中验证逻辑？
- [ ] 验证后是否建议重构到 src/？
- [ ] 是否遵循项目目录结构？
- [ ] 命名是否符合约定？

---

## 阶段 V0.3：Notebook 结构

**目标**：验证"数据叙述者"角色和结构规范

**新增规范**：

```markdown
## Notebook 规范

### 核心角色：数据叙述者

Notebook 是讲述数据故事的媒介。引导读者理解：
- 我们在探索什么问题？
- 为什么采用这种方法？
- 数据告诉了我们什么？
- 这些发现意味着什么？

### 结构要求

- H1 - Notebook 主题
- H2 - 主要章节
- H3 - 章节内子主题
```

**验证任务**：

```
请分析 titanic 数据集中乘客存活率的影响因素
```

**验证清单**：

- [ ] 是否有清晰的 H1 主题标题？
- [ ] 是否以叙述者口吻引导阅读？
- [ ] 章节层级是否清晰（H1/H2/H3）？
- [ ] 是否回答了"发现了什么"和"意味着什么"？

---

## 阶段 V0.4：单元格规范

**目标**：验证 Markdown 和代码单元格的规范使用

**新增规范**：

```markdown
### 单元格规范

**Markdown 单元格**：
- 代码前说明"做什么"和"为什么"
- 输出后解读"发现了什么"
- 公式使用 LaTeX

**代码单元格**：
- 单个单元格专注一个任务（< 30 行）
- 关键中间结果显式输出

### 可复现性

- 固定随机种子
- 使用相对路径
- 确保 Restart & Run All 可执行
```

**验证任务**：

```
请用机器学习方法预测房价（可模拟数据）
```

**验证清单**：

- [ ] 每个代码块前是否有说明？
- [ ] 输出后是否有解读？
- [ ] 代码单元格是否简短聚焦？
- [ ] 是否可以 Restart & Run All？

---

## 阶段 V1.0：整合验证

**目标**：端到端验证完整模板

**验证任务**：

```
请完成一个完整的数据分析项目：
1. 探索某个数据集
2. 发现有价值的模式
3. 如果逻辑可复用，建议如何重构到 src/
```

**验证清单**：

- [ ] 体现探索循环思维
- [ ] 遵循开发流程（Notebook → src/）
- [ ] 以叙述者角色组织内容
- [ ] 结构层级清晰
- [ ] 单元格规范
- [ ] 可复现

---

## 验证工具

```python
# verify_notebook.py
import json

def verify_notebook(notebook_path: str) -> dict:
    """验证 Notebook 是否符合规范"""
    with open(notebook_path, 'r', encoding='utf-8') as f:
        nb = json.load(f)

    cells = nb['cells']
    results = {
        'has_h1_title': False,
        'has_conclusion': False,
        'max_consecutive_code': 0,
    }

    # 检查 H1 标题和结论
    for cell in cells:
        if cell['cell_type'] == 'markdown':
            source = ''.join(cell['source'])
            if source.strip().startswith('# '):
                results['has_h1_title'] = True
            if any(kw in source for kw in ['结论', '总结', '发现']):
                results['has_conclusion'] = True

    # 检查连续代码块
    max_consecutive = current = 0
    for cell in cells:
        if cell['cell_type'] == 'code':
            current += 1
            max_consecutive = max(max_consecutive, current)
        else:
            current = 0
    results['max_consecutive_code'] = max_consecutive

    return results
```

---

## 迭代记录

### V0.1 - 核心理念

- **日期**:
- **测试任务**: iris 探索
- **结果**: /4 通过
- **问题**:
- **调整**:

### V0.2 - 工程规范

- **日期**:
- **测试任务**: 数据加载工具
- **结果**: /4 通过
- **问题**:
- **调整**:

### V0.3 - Notebook 结构

- **日期**:
- **测试任务**: titanic 分析
- **结果**: /4 通过
- **问题**:
- **调整**:

### V0.4 - 单元格规范

- **日期**:
- **测试任务**: 房价预测
- **结果**: /4 通过
- **问题**:
- **调整**:

### V1.0 - 整合验证

- **日期**:
- **测试任务**: 完整项目
- **结果**: /6 通过
- **问题**:
- **调整**:
